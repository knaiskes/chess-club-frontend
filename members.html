<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Members</title>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      [x-cloak] {
	  display: none !important;
      }
    </style>
  </head>
  <body x-data x-init="fetch('./navbar.html').then(response => response.text()).then(html => $refs.navbar.innerHTML = html)">
    <div x-ref="navbar"></div>
    <div x-data="membersTable()" x-init="init()" x-cloak>
      <h4 class="mb-10 text-4xl text-center font-extrabold leading-none tracking-tight text-gray-900 md:text-5xl lg:text-6xl dark:text-gray">Members</h4>
<div class="overflow-x-auto">
  <table class="min-w-full divide-y divide-gray-200 border-collapse">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-3 text-left text-xs uppercase tracking-wider">First Name</th>
        <th class="px-6 py-3 text-left text-xs uppercase tracking-wider">Last Name</th>
        <th class="px-6 py-3 text-left text-xs uppercase tracking-wider">Age</th>
        <th class="px-6 py-3 text-left text-xs uppercase tracking-wider">Gender</th>
        <th class="px-6 py-3 text-left text-xs uppercase tracking-wider">Email</th>
        <th class="px-6 py-3 text-left text-xs tracking-wider">Is Active</th>
        <th class="px-6 py-3 text-left text-xs uppercase tracking-wider">FIDE Rating</th>
        <th class="px-6 py-3 text-left text-xs uppercase tracking-wider">Overdue Subscription</th>
        <th class="px-6 py-3 text-left text-xs uppercase tracking-wider">Profile Photo URL</th>
        <th class="px-6 py-3 text-left text-xs uppercase tracking-wider">Lichess Profile</th>
        <th class="px-6 py-3 text-left text-xs uppercase tracking-wider">Chess.com Profile</th>
        <th class="px-6 py-3 text-left text-xs uppercase tracking-wider">FIDE Profile</th>
        <th class="px-6 py-3 text-left text-xs uppercase tracking-wider">Joined At</th>
	<th class="px-6 py-3 text-left text-xs uppercase tracking-wider">Details</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <template x-for="member in members" :key="member.id">
        <tr class="hover:bg-gray-100">
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="member.firstname"></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="member.lastname"></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="member.age"></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="member.gender"></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="member.email"></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="member.is_active ? 'Yes' : 'No'"></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="member.fide_rating !== null ? member.fide_rating : 'N/A'"></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="member.overdue_subscription ? 'Yes' : 'No'"></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="member.profile_photo_url !== null ? member.profile_photo_url : 'N/A'"></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="member.lichess_profile !== null ? member.lichess_profile : 'N/A'"></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="member.chesscom_profile !== null ? member.chesscom_profile : 'N/A'"></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="member.fide_profile !== null ? member.fide_profile : 'N/A'"></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="new Date(member.joined_at).toLocaleString()"></td>
	  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="member.id"></td>
        </tr>
      </template>
    </tbody>
  </table>
</div>

    </div>


    <script>
      function membersTable() {
        return {
          members: [],
          async init() {
            await this.fetchMembers();
          },
          async fetchMembers() {
	    const token = localStorage.getItem('jwt_token');
            if (!token) {
              window.location.href = 'login.html';
            } else {
              try {
		const response = await fetch('http://localhost:3000/api/v1/members', {
		  method: 'GET',
		  headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                  }
		});
		const data = await response.json();
		this.members = data.members;
              } catch (error) {
		console.error('Error fetching members:', error);
              }
	    }
          }
        }
      }
    </script>
  </body>
</html>
